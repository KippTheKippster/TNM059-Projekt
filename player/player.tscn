[gd_scene load_steps=23 format=3 uid="uid://vyiym37a71px"]

[ext_resource type="Script" path="res://player/player.gd" id="1_wbiqq"]
[ext_resource type="PackedScene" uid="uid://c8dkml17lg3e1" path="res://player/player_test_v2.glb" id="2_5m4cv"]
[ext_resource type="Texture2D" uid="uid://b6mw6l8nn6eab" path="res://assets/ui/Crosshair.png" id="2_nxp81"]
[ext_resource type="PackedScene" uid="uid://b2x2oamlwh8xs" path="res://assets/ship.blend" id="2_rs7pv"]
[ext_resource type="PackedScene" uid="uid://da5pumyn1st8" path="res://common/health/health_area.tscn" id="2_xq6mt"]
[ext_resource type="Script" path="res://player/missile_target_raycast.gd" id="4_7h3uj"]
[ext_resource type="Script" path="res://addons/godot_state_charts/state_chart.gd" id="6_can2k"]
[ext_resource type="Script" path="res://addons/godot_state_charts/parallel_state.gd" id="7_l0jdq"]
[ext_resource type="Script" path="res://addons/godot_state_charts/compound_state.gd" id="8_elmug"]
[ext_resource type="Script" path="res://addons/godot_state_charts/atomic_state.gd" id="9_765a5"]
[ext_resource type="Script" path="res://addons/godot_state_charts/transition.gd" id="10_csslr"]
[ext_resource type="Script" path="res://addons/godot_state_charts/expression_guard.gd" id="11_gw10l"]
[ext_resource type="Script" path="res://addons/godot_state_charts/animation_player_state.gd" id="11_kxvfd"]

[sub_resource type="BoxShape3D" id="BoxShape3D_fhyyo"]
size = Vector3(1.8642, 1, 2)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_4uach"]

[sub_resource type="Animation" id="Animation_buqbx"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("..:rotation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0, 0, 0)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:rotation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0, 0, 0)]
}
tracks/2/type = "bezier"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath(".:rotation:x")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"handle_modes": PackedInt32Array(0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0)
}
tracks/3/type = "bezier"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath(".:rotation:y")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"handle_modes": PackedInt32Array(0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0)
}
tracks/4/type = "bezier"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath(".:rotation:z")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"handle_modes": PackedInt32Array(0),
"points": PackedFloat32Array(6.28319, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0)
}

[sub_resource type="Animation" id="Animation_1p3o1"]
resource_name = "spin_left"
length = 0.5
tracks/0/type = "bezier"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:rotation:x")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"handle_modes": PackedInt32Array(0, 0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0, 0, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0, 0.5)
}
tracks/1/type = "bezier"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:rotation:y")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"handle_modes": PackedInt32Array(0, 0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0, 0, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0, 0.5)
}
tracks/2/type = "bezier"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath(".:rotation:z")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"handle_modes": PackedInt32Array(0, 0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0, 6.28319, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0, 0.5)
}

[sub_resource type="Animation" id="Animation_yt6ap"]
resource_name = "spin_right"
length = 0.5
tracks/0/type = "bezier"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:rotation:x")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"handle_modes": PackedInt32Array(0, 0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0, 0, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0, 0.5)
}
tracks/1/type = "bezier"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:rotation:y")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"handle_modes": PackedInt32Array(0, 0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0, 0, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0, 0.5)
}
tracks/2/type = "bezier"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath(".:rotation:z")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"handle_modes": PackedInt32Array(0, 0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0, -6.283, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0, 0.5)
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_4xqpq"]
_data = {
"RESET": SubResource("Animation_buqbx"),
"spin_left": SubResource("Animation_1p3o1"),
"spin_right": SubResource("Animation_yt6ap")
}

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_7cs1m"]
radius = 0.392519
height = 2.45711

[sub_resource type="BoxShape3D" id="BoxShape3D_23m8h"]
size = Vector3(1.6, 1.6, 1.6)

[sub_resource type="Resource" id="Resource_ufqae"]
script = ExtResource("11_gw10l")
expression = "active_missiles == 0"

[node name="Player" type="CharacterBody3D" groups=["player"]]
collision_layer = 4
collision_mask = 4
motion_mode = 1
floor_constant_speed = true
platform_on_leave = 2
script = ExtResource("1_wbiqq")
move_speed = 7.0
acceleration = 24.0
deceleration = 16.0
max_rotation_degrees = Vector3(25, 35, 25)
rotation_acceleration = 5.0
rotation_deceleration = 3.0

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.058136, 0, -0.143577)
shape = SubResource("BoxShape3D_fhyyo")

[node name="RotationContainer" type="Node3D" parent="."]

[node name="ShipContainer" type="Node3D" parent="RotationContainer"]
transform = Transform3D(1, -4.46638e-06, 0, 4.46638e-06, 1, 0, 0, 0, 1, 0, 0, 0)

[node name="player_test_v2" parent="RotationContainer/ShipContainer" instance=ExtResource("2_5m4cv")]
transform = Transform3D(0.308771, 1.37909e-06, 0, -1.37909e-06, 0.308771, 0, 0, 0, 0.308771, 0, 0, 0)

[node name="Cube_006" parent="RotationContainer/ShipContainer/player_test_v2" index="1"]
transform = Transform3D(0.553568, 0, 0, 0, 0.451114, 0.0979676, 0, -0.035553, 1.24306, 0, 0.834604, 1.00022)
visible = false

[node name="Cube_008" parent="RotationContainer/ShipContainer/player_test_v2" index="2"]
transform = Transform3D(1, 0, 0, 0, -0.418811, 0.0252951, 0, 0.0225359, 0.470088, 0, 0.67721, 3.01706)
surface_material_override/0 = SubResource("StandardMaterial3D_4uach")

[node name="Cube" parent="RotationContainer/ShipContainer/player_test_v2" index="3"]
transform = Transform3D(1, 0, 0, 0, 1.31394, 0, 0, 0, 1, 0, -0.109507, 0)

[node name="Cylinder_003" parent="RotationContainer/ShipContainer/player_test_v2" index="8"]
transform = Transform3D(0, -2.48688e-08, 0.521469, 0.265987, 0, -3.1082e-08, -1.5854e-08, 0.417229, 0, 0, -0.0162048, 3.73398)

[node name="Cube_003" parent="RotationContainer/ShipContainer/player_test_v2" index="9"]
transform = Transform3D(1.30452, 0, 0, 0, -0.402512, 0, 0, 0, 1, 0, -0.109507, 3.50234)

[node name="Ship" parent="RotationContainer/ShipContainer" instance=ExtResource("2_rs7pv")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -1.95329, -2.82269, 0)
visible = false

[node name="ShipAnimationPlayer" type="AnimationPlayer" parent="RotationContainer/ShipContainer"]
unique_name_in_owner = true
libraries = {
"": SubResource("AnimationLibrary_4xqpq")
}

[node name="HealthArea" parent="RotationContainer" instance=ExtResource("2_xq6mt")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0.200817)
health = 10.0
layer = 1

[node name="CollisionShape3D" type="CollisionShape3D" parent="RotationContainer/HealthArea"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0)
shape = SubResource("CapsuleShape3D_7cs1m")

[node name="ShootMarker3D" type="Marker3D" parent="RotationContainer"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -3.06048)

[node name="MissleTargetRayCast" type="ShapeCast3D" parent="RotationContainer" node_paths=PackedStringArray("target_node")]
shape = SubResource("BoxShape3D_23m8h")
collide_with_areas = true
script = ExtResource("4_7h3uj")
length = 48.0
target_node = NodePath("../Crosshair1")

[node name="Crosshair1" type="Sprite3D" parent="RotationContainer"]
transform = Transform3D(0.6, 0, 0, 0, 0.6, 0, 0, 0, 0.6, 0, 0, -6.25015)
billboard = 1
no_depth_test = true
fixed_size = true
texture_filter = 0
texture = ExtResource("2_nxp81")
hframes = 4

[node name="Crosshair2" type="Sprite3D" parent="RotationContainer"]
transform = Transform3D(0.4, 0, 0, 0, 0.4, 0, 0, 0, 0.4, 0, 0, -8.34054)
billboard = 1
no_depth_test = true
fixed_size = true
texture_filter = 0
texture = ExtResource("2_nxp81")
hframes = 4
frame = 1

[node name="ShootCooldownTimer" type="Timer" parent="."]
wait_time = 0.1
one_shot = true

[node name="StateChart" type="Node" parent="."]
script = ExtResource("6_can2k")

[node name="Root" type="Node" parent="StateChart"]
script = ExtResource("7_l0jdq")

[node name="Control" type="Node" parent="StateChart/Root"]
script = ExtResource("8_elmug")
initial_state = NodePath("Regular")

[node name="Regular" type="Node" parent="StateChart/Root/Control"]
script = ExtResource("9_765a5")

[node name="Cutscene" type="Node" parent="StateChart/Root/Control"]
script = ExtResource("9_765a5")

[node name="Movement" type="Node" parent="StateChart/Root"]
script = ExtResource("8_elmug")
initial_state = NodePath("Idle")

[node name="Idle" type="Node" parent="StateChart/Root/Movement"]
script = ExtResource("9_765a5")

[node name="Boost" type="Node" parent="StateChart/Root/Movement/Idle"]
script = ExtResource("10_csslr")
to = NodePath("../../Boost")
event = &"boost"

[node name="Brake" type="Node" parent="StateChart/Root/Movement/Idle"]
script = ExtResource("10_csslr")
to = NodePath("../../Brake")
event = &"brake"

[node name="Boost" type="Node" parent="StateChart/Root/Movement"]
script = ExtResource("9_765a5")

[node name="BoostRelease" type="Node" parent="StateChart/Root/Movement/Boost"]
script = ExtResource("10_csslr")
to = NodePath("../../Idle")
event = &"boost_release"

[node name="Brake" type="Node" parent="StateChart/Root/Movement"]
script = ExtResource("9_765a5")

[node name="BrakeRelease" type="Node" parent="StateChart/Root/Movement/Brake"]
script = ExtResource("10_csslr")
to = NodePath("../../Idle")
event = &"brake_release"

[node name="Action" type="Node" parent="StateChart/Root"]
script = ExtResource("8_elmug")
initial_state = NodePath("Idle")

[node name="Idle" type="Node" parent="StateChart/Root/Action"]
script = ExtResource("9_765a5")

[node name="RollRight" type="Node" parent="StateChart/Root/Action/Idle"]
script = ExtResource("10_csslr")
to = NodePath("../../Roll/RollRight")
event = &"roll_right"

[node name="RollLeft" type="Node" parent="StateChart/Root/Action/Idle"]
script = ExtResource("10_csslr")
to = NodePath("../../Roll/RollLeft")
event = &"roll_left"

[node name="Roll" type="Node" parent="StateChart/Root/Action"]
script = ExtResource("8_elmug")
initial_state = NodePath("RollRight")

[node name="RollRight" type="Node" parent="StateChart/Root/Action/Roll"]
script = ExtResource("11_kxvfd")
animation_player = NodePath("../../../../../RotationContainer/ShipContainer/ShipAnimationPlayer")
animation_name = &"spin_right"

[node name="RollEnd" type="Node" parent="StateChart/Root/Action/Roll/RollRight"]
script = ExtResource("10_csslr")
to = NodePath("../../../Idle")
event = &"roll_end"

[node name="RollLeft" type="Node" parent="StateChart/Root/Action/Roll"]
script = ExtResource("11_kxvfd")
animation_player = NodePath("../../../../../RotationContainer/ShipContainer/ShipAnimationPlayer")
animation_name = &"spin_left"

[node name="RollEnd" type="Node" parent="StateChart/Root/Action/Roll/RollLeft"]
script = ExtResource("10_csslr")
to = NodePath("../../../Idle")
event = &"roll_end"

[node name="Missile" type="Node" parent="StateChart/Root"]
script = ExtResource("8_elmug")
initial_state = NodePath("Inactive")

[node name="Inactive" type="Node" parent="StateChart/Root/Missile"]
script = ExtResource("9_765a5")

[node name="Hold" type="Node" parent="StateChart/Root/Missile/Inactive"]
script = ExtResource("10_csslr")
to = NodePath("../../Active")
event = &"fire_press"
guard = SubResource("Resource_ufqae")
delay_seconds = 0.3

[node name="Active" type="Node" parent="StateChart/Root/Missile"]
script = ExtResource("9_765a5")

[node name="Release" type="Node" parent="StateChart/Root/Missile/Active"]
script = ExtResource("10_csslr")
to = NodePath("../../Inactive")
event = &"fire_release"

[connection signal="animation_finished" from="RotationContainer/ShipContainer/ShipAnimationPlayer" to="." method="_on_ship_animation_player_animation_finished"]
[connection signal="damaged" from="RotationContainer/HealthArea" to="." method="_on_health_area_damaged"]
[connection signal="state_entered" from="StateChart/Root/Movement/Idle" to="." method="_on_movement_idle_state_entered"]
[connection signal="state_entered" from="StateChart/Root/Movement/Boost" to="." method="_on_boost_state_entered"]
[connection signal="state_entered" from="StateChart/Root/Movement/Brake" to="." method="_on_brake_state_entered"]
[connection signal="state_entered" from="StateChart/Root/Missile/Inactive" to="." method="_on_missile_inactive_state_entered"]
[connection signal="state_physics_processing" from="StateChart/Root/Missile/Inactive" to="." method="_on_missile_inactive_state_physics_processing"]
[connection signal="state_entered" from="StateChart/Root/Missile/Active" to="." method="_on_missile_active_state_entered"]
[connection signal="state_exited" from="StateChart/Root/Missile/Active" to="." method="_on_missile_active_state_exited"]
[connection signal="state_physics_processing" from="StateChart/Root/Missile/Active" to="." method="_on_missile_active_state_physics_processing"]

[editable path="RotationContainer/ShipContainer/player_test_v2"]
